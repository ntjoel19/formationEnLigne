<!--
  Generated template for the ClassManagementPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>
  <ion-navbar color="twitter" hideBackButton="true">
    <button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title>Gestion des Cours </ion-title>
  </ion-navbar>
</ion-header>


<ion-content class="lis-content">
  <img src="assets/img/big-img.png" class="head-img" />
  <div class="profile-content">
    <ion-segment mode="ios" [(ngModel)]="tabs" class="tabs" margin-top margin-horizontal>
      <ion-segment-button value="0" (click)="selectTab(0)">
        <ion-icon name="paper" color="twitter"></ion-icon>
        Liste des PFMs
      </ion-segment-button>
      <ion-segment-button value="1" (click)="selectTab(1)">
        <ion-icon name="md-add-circle" color="twitter"></ion-icon>
        Add/edit Course
      </ion-segment-button>
    </ion-segment>
    <ion-slides class="app-slider" #mySlider (ionSlideWillChange)="changeWillSlide($event)"  [ngSwitch]="tabs">
      <ion-slide (ionScroll)="scrollingFun($event)">
        <ion-list padding-horizontal no-margin *ngIf="observeOffline">
          <ion-item *ngFor="let item of onlineCourseList" style="border-radius: 10px;border-width: 1px;border-color: dodgerblue;" no-lines>
            <ion-avatar item-start>
              <img src="{{item.descriptImage}}">
            </ion-avatar>
            <h2>{{item.title}}</h2>
            <p>{{item.subtitle}}</p>
            <button ion-button clear item-end><ion-icon name="md-information-circle" color="twitter"></ion-icon></button>
            <button ion-button clear (click)="editCourse(item)" item-end><ion-icon name="md-brush"  color="twitter"></ion-icon></button>
            <button ion-button clear (click)="delCourse(item)" item-end><ion-icon name="md-trash" color="danger"></ion-icon></button>
          </ion-item>
        </ion-list>
        <ion-list padding-horizontal no-margin *ngIf="!observeOffline">
          <ion-item *ngFor="let item of offlineCourseList" style="border-radius: 10px; border-width: 1px;border-color: dodgerblue;" no-lines>
            <ion-avatar item-start>
              <img src="{{item.descriptImage}}">
            </ion-avatar>
            <h2>{{item.title}}</h2>
            <p>{{item.subtitle}}</p>
            <button ion-button clear item-end><ion-icon name="md-information-circle" color="twitter"></ion-icon></button>
            <button ion-button clear (click)="editCourse(item)" item-end><ion-icon name="md-brush"  color="twitter"></ion-icon></button>
            <button ion-button clear (click)="delCourse(item)" item-end><ion-icon name="md-trash" color="danger"></ion-icon></button>
          </ion-item>
        </ion-list>
      </ion-slide>
      <ion-slide>
        <form [formGroup]="form" (ngSubmit)="manage(form.value)" padding>
          <ion-list >
              <ion-item>
                <ion-label>Ce PFM est-il accessible à tous?</ion-label>
                <ion-checkbox (click)="authorize()" formControlName="authorisation"></ion-checkbox>
              </ion-item>
              <ion-item>
                <ion-label>Associer des formateurs pour vous seconder</ion-label>
                <ion-select formControlName="associateProf" multiple="true">
                  <span>
                    <ion-option *ngFor="let teacher of teacherList | async; let idx = index" value="{{teacher.email}}" selected="{{tableSelect[idx]}}">
                      {{teacher.name}} {{teacher.firstname}}
                    </ion-option>
                  </span>
                </ion-select>
              </ion-item>
              <ion-item (click)="toggleSection(0,false)" detail-none>
                <ion-icon item-left name="arrow-dropright" *ngIf="!section[0]"></ion-icon>
                <ion-icon item-left name="arrow-dropdown" *ngIf="section[0]"></ion-icon>
                  Informations générales sur le PFM
              </ion-item>
              <ion-list *ngIf="section[0]" no-lines>
                <ion-item no-padding *ngIf="plateformSetup==='android'" >
                    <div icon-left *ngIf="courses.descriptImage==='' && imageForView===''" (click)="presentActionSheet('jpg','descriptImage',0,0,0)">
                      Image descriptive (Elle sera affichée comme arriere plan dans la liste des cours) <ion-icon name="camera" ></ion-icon>
                    </div>
                    <div *ngIf="courses.descriptImage!=='' && imageForView===''" (click)="presentActionSheet('jpg','descriptImage',0,0,0)" style="border-color: antiquewhite;border-radius: 10px">
                      Image descriptive (Elle sera affichée comme 'arriere plan dans la liste des cours)<img src="{{courses.descriptImage}}">
                    </div>
                    <div *ngIf="courses.descriptImage!=='' && imageForView!==''" (click)="presentActionSheet('jpg','descriptImage',0,0,0)" style="border-color: antiquewhite;border-radius: 10px">
                      Image descriptive (Elle sera affichée comme arriere plan dans la liste des cours)<img src="{{imageForView}}">
                    </div>
                    <div *ngIf="courses.descriptImage==='' && imageForView!==''" (click)="presentActionSheet('jpg','descriptImage',0,0,0)" style="border-radius: 100px;">
                      Image descriptive (Elle sera affichée comme arriere plan dans la liste des cours)<img src="{{imageForView}}">
                    </div>
                </ion-item>
                <ion-item no-padding (click)="presentActionSheet('jpg','descriptImage',0,0,0)" *ngIf="plateformSetup==='notAndroid'" >
                  <ion-avatar *ngIf="courses.descriptImage==='' && imagePath===''" >
                    Image descriptive (Elle sera affichée comme arriere plan dans la liste des cours) <ion-icon icon-left name="camera" ></ion-icon>
                  </ion-avatar>
                  <div *ngIf="courses.descriptImage!=='' && imagePath===''"  style="border-radius: 100px;">
                    Image descriptive <img src="{{courses.descriptImage}}">
                  </div>
                  <div *ngIf="courses.descriptImage!=='' && imagePath!==''" style="border-radius: 100px;">
                    Image descriptive <img src="{{image}}">
                  </div>
                  <div *ngIf="courses.descriptImage==='' && imagePath!==''" style="border-radius: 100px;">
                    Image descriptive <img src="{{image}}">
                  </div>
                </ion-item>
                <ion-item no-padding>
                  <ion-label floating>Titre du PFM</ion-label>
                  <ion-input type="text" formControlName="title">Par defaut</ion-input>
                </ion-item>
                  <ion-item no-padding> 
                    <ion-label floating>Numéro du PFM (Ex: 3)</ion-label>
                    <ion-input type="number" formControlName="subtitle" ></ion-input>
                </ion-item>
                <ion-item hidden no-padding> 
                  <ion-label floating>Posted by</ion-label>
                  <ion-input type="text" hidden formControlName="PostedBy" ></ion-input>
                </ion-item>
                <ion-item hidden no-padding> 
                  <ion-label floating>key</ion-label>
                  <ion-input type="text" hidden formControlName="key" ></ion-input>
                </ion-item>
                
                <ion-item no-padding>
                  <ion-label floating>Donnez un résumé de ce programme</ion-label>
                  <ion-textarea cols="40" formControlName="description"></ion-textarea>
                </ion-item>
                <ion-item no-padding>
                  <ion-label floating>Date de lancement</ion-label>
                  <ion-datetime displayFormat="DD/MM/YYYY" min="2019" max="2030-10-31" formControlName="startDate"></ion-datetime>
                </ion-item>
                <ion-item no-padding>
                  <ion-label floating>Date de fin</ion-label>
                  <ion-datetime displayFormat="DD/MM/YYYY" min="2019" max="2030-10-31" formControlName="duration"></ion-datetime>
                </ion-item>
                <ion-item no-padding>
                  <ion-label floating>Auteur (Ex: Ntepp Jean Joël)</ion-label>
                  <ion-input type="text" formControlName="teacher"></ion-input>
                </ion-item>
              </ion-list>
              <div class="user-name" class="formArray" formArrayName="chapter">
                <ion-item (click)="toggleSection(1,false)" detail-none >
                  <ion-icon item-left name="arrow-dropright" *ngIf="!section[1]"></ion-icon>
                  <ion-icon item-left name="arrow-dropdown" *ngIf="section[1]"></ion-icon>
                  <ion-icon name="list-box" ></ion-icon>
                    Liste des chapitres du programme
                  <span ion-button float-right icon-left clear (click)="addNewInputField()">
                    <ion-icon name="add-circle"></ion-icon>
                  </span>
                </ion-item>
                <section [formGroupName]="i" *ngFor="let tech of form.controls.chapter.controls; let i = index">
                  <ion-item-group *ngIf="section[1]">
                      <ion-item  no-padding>
                        <ion-label floating>Titre du Chapitre {{ i + 1 }} : </ion-label>
                        <ion-input type="text" formControlName="name"></ion-input>
                      </ion-item>
                      <ion-item  no-padding>
                        <ion-label floating>Date de fin</ion-label>
                        <ion-datetime displayFormat="DD/MM/YYYY" min="2019" max="2030-10-31" formControlName="durationChap"></ion-datetime>
                      </ion-item>
                      <ion-item  no-padding>
                        <ion-label floating>Résumé du chapitre</ion-label>
                        <ion-textarea formControlName="description"></ion-textarea>
                      </ion-item>
                      <span float-right ion-button icon-left clear *ngIf="form.controls.chapter.length > 1" (click)="removeInputField(i)">
                        <ion-icon name="close"></ion-icon>
                        suppr. chap {{i+1}}
                      </span>
                      <div float-right class="formArray" class="lecon" formArrayName="lecon">
                        <ion-item (click)="toggleSection(2,false)" detail-none >
                          <ion-icon item-left name="arrow-dropright" *ngIf="!section[2]"></ion-icon>
                          <ion-icon item-left name="arrow-dropdown" *ngIf="section[2]"></ion-icon>
                          <ion-icon name="list-box" ></ion-icon>
                            Liste des leçons du chapitre {{i+1}}
                          <span ion-button float-right icon-left clear (click)="addNewLeconInputField(i,2)">
                            <ion-icon name="add-circle"></ion-icon>
                          </span>
                        </ion-item>
                        <section [formGroupName]="j" *ngFor="let lec of form.controls.chapter.controls[i].controls.lecon.controls; let j = index">
                          <ion-item-group *ngIf="section[2]">
                              <ion-item no-padding>
                                <ion-label floating>Titre de la lecon {{ j + 1 }} : </ion-label>
                                <ion-input type="text" formControlName="leconTitle"></ion-input>
                              </ion-item>
                              <span float-right ion-button icon-left clear *ngIf="form.controls.chapter.controls[i].controls.lecon.controls.length > 1" (click)="removeLeconInputField(i,j)">
                                <ion-icon name="close"></ion-icon>
                                Suppr. la leçon {{j+1}}
                              </span>
                              <div float-right class="files_div" class="formArray" formArrayName="material">
                                <ion-item (click)="toggleSection(3,false)" detail-none >
                                  <ion-icon item-left name="arrow-dropright" *ngIf="!section[3]"></ion-icon>
                                  <ion-icon item-left name="arrow-dropdown" *ngIf="section[3]"></ion-icon>
                                  <ion-icon name="attach" ></ion-icon>
                                    Fichiers de la leçon {{j+1}}
                                  <span ion-button float-right icon-left clear (click)="addNewFileInputField(i,j,3)">
                                    <ion-icon name="add-circle"></ion-icon>
                                  </span>
                                </ion-item>
                                <section [formGroupName]="k" *ngFor="let matos of form.controls.chapter.controls[i].controls.lecon.controls[j].controls.material.controls; let k = index">
                                  <ion-item-group *ngIf="section[3]">
                                      <ion-item no-padding>
                                        <ion-label floating>Fichier {{ k + 1 }} : </ion-label>
                                        <ion-input type="text" formControlName="name"></ion-input>
                                      </ion-item>
                                      <ion-item no-padding>
                                        <ion-label floating>catégorie du fichier {{ k + 1 }} : </ion-label>
                                        <ion-select [selectOptions]="selectOptions" formControlName="type">
                                          <ion-option value='.pdf'>
                                            <ion-icon ></ion-icon>
                                            pdf
                                          </ion-option>
                                          <ion-option value='.docx'>
                                            <span></span>
                                            word
                                          </ion-option>
                                          <ion-option value='.pptx'>
                                            <span></span>
                                            powerPoint
                                          </ion-option>
                                          <ion-option >
                                            <span value='.xlsx'></span>
                                            Excel
                                          </ion-option>
                                          <ion-option >
                                            <span value='.mp4'></span>
                                            vidéo
                                          </ion-option>
                                        </ion-select>
                                      </ion-item>
                                      <ion-item style="border-color: antiquewhite;border-radius: 10px">
                                        <div (click)="presentActionSheet2('pdf','materials',k,j,i)">
                                          <ion-label floating></ion-label>
                                          <img style="width:50px;height: 50px" src="assets/img/pic1.png">
                                        </div>
                                      </ion-item>
                                      <ion-item no-padding (click)="presentActionSheet2('pdf','materials',k,j,i)">
                                        Uplaoder le fichier {{ k + 1 }} : <ion-icon name="md-cloud-upload"></ion-icon>
                                      </ion-item>
                                      
                                      <span float-right ion-button icon-left clear *ngIf="form.controls.chapter.controls[i].controls.lecon.controls[j].controls.material.controls.length > 1" (click)="removeFileInputField(i,j,k)">
                                        <ion-icon name="close"></ion-icon>
                                        Suppr. le fichier {{k+1}}
                                      </span>
                                  </ion-item-group>
                                </section>
                                
                              </div>
                              <div float-right class="files_div" class="formArray" formArrayName="quizz">
                                <ion-item (click)="toggleSection(4,false)" detail-none >
                                  <ion-icon item-left name="arrow-dropright" *ngIf="!section[4]"></ion-icon>
                                  <ion-icon item-left name="arrow-dropdown" *ngIf="section[4]"></ion-icon>
                                  <ion-icon name="attach" ></ion-icon>
                                    Exercice de la leçon {{j+1}}
                                  <span ion-button float-right icon-left clear (click)="addNewQuizzInputField(i,j,4)">
                                    <ion-icon name="add-circle"></ion-icon>
                                  </span>
                                </ion-item>
                                <section [formGroupName]="l" *ngFor="let exercice of form.controls.chapter.controls[i].controls.lecon.controls[j].controls.quizz.controls; let l = index">
                                    <ion-item-group *ngIf="section[4]">
                                        <ion-item no-padding>
                                          <ion-label floating>Titre de l'exercice {{ l + 1 }} : </ion-label>
                                          <ion-input type="text" formControlName="name"></ion-input>
                                        </ion-item>
                                        <ion-item no-padding>
                                          <ion-label floating>type de fichier {{ l + 1 }} : </ion-label>
                                          <ion-select  [selectOptions]="selectOptions" formControlName="type">
                                            <ion-option value='.pdf'>
                                              <ion-icon ></ion-icon>
                                              pdf
                                            </ion-option>
                                            <ion-option value='.docx'>
                                              <span></span>
                                              word
                                            </ion-option>
                                            <ion-option value='.pptx'>
                                              <span></span>
                                              powerPoint
                                            </ion-option>
                                            <ion-option >
                                              <span value='.mp4'></span>
                                              vidéo
                                            </ion-option>
                                            <ion-option >
                                              <span value='.xlsx'></span>
                                              Excel
                                            </ion-option>
                                          </ion-select>
                                        </ion-item>
                                        <ion-item (click)="presentActionSheet2('pdf','quizz',l,j,i)" no-padding>
                                          uploader {{ l + 1 }} : <ion-icon name="md-cloud-upload"></ion-icon>
                                        </ion-item>
                                        
                                        <span float-right ion-button icon-left clear *ngIf="form.controls.chapter.controls[i].controls.lecon.controls[j].controls.quizz.controls.length > 1" (click)="removeQuizzInputField(i,j,l)">
                                          <ion-icon name="close"></ion-icon>
                                          Remove quizz {{l+1}}
                                        </span>
                                    </ion-item-group>
                                </section>
                                
                              </div>
                          </ion-item-group>
                        </section>
                        
                      </div>
                  </ion-item-group>
                </section>
              </div>
          </ion-list>
          <button ion-button block *ngIf="!edit" margin-top color="twitter" text-center >Submit</button>
          <button ion-button block *ngIf="edit" margin-top color="twitter" text-center >save changes</button>
        </form>      
      </ion-slide>
    </ion-slides>
  </div>
</ion-content>